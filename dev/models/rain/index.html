<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Rainfall · StochasticWeatherGenerators.jl</title><meta name="title" content="Rainfall · StochasticWeatherGenerators.jl"/><meta property="og:title" content="Rainfall · StochasticWeatherGenerators.jl"/><meta property="twitter:title" content="Rainfall · StochasticWeatherGenerators.jl"/><meta name="description" content="Documentation for StochasticWeatherGenerators.jl."/><meta property="og:description" content="Documentation for StochasticWeatherGenerators.jl."/><meta property="twitter:description" content="Documentation for StochasticWeatherGenerators.jl."/><meta property="og:url" content="https://dmetivie.github.io/StochasticWeatherGenerators.jl/models/rain/"/><meta property="twitter:url" content="https://dmetivie.github.io/StochasticWeatherGenerators.jl/models/rain/"/><link rel="canonical" href="https://dmetivie.github.io/StochasticWeatherGenerators.jl/models/rain/"/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/citations.css" rel="stylesheet" type="text/css"/><link href="../../assets/table.css" rel="stylesheet" type="text/css"/><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="StochasticWeatherGenerators.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">StochasticWeatherGenerators.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">📘 Models</span><ul><li class="is-active"><a class="tocitem" href>Rainfall</a><ul class="internal"><li><a class="tocitem" href="#WGEN-—-Multisite-latent-Gaussian-Rain-Occurrence-Model"><span>WGEN — Multisite latent Gaussian Rain Occurrence Model</span></a></li><li><a class="tocitem" href="#SHHMM-—-Seasonal-Hierarchical-Hidden-Markov-Model"><span>SHHMM — Seasonal Hierarchical Hidden Markov Model</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../others/">Temperature &amp; Others</a></li></ul></li><li><a class="tocitem" href="../../data/">📅 Weather Data</a></li><li><span class="tocitem">📎 Tutorials</span><ul><li><a class="tocitem" href="../../examples/tuto_paper/">Multisite rainfall HMM based SWG (paper) </a></li><li><a class="tocitem" href="../../examples/tuto_add_station_variable/">Multivariate SWG: Application to crop model</a></li></ul></li><li><a class="tocitem" href="../../api/">🧰 Utilities</a></li><li><a class="tocitem" href="../../other_pkg/">🌐 Other SWG Packages</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">📘 Models</a></li><li class="is-active"><a href>Rainfall</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Rainfall</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/dmetivie/StochasticWeatherGenerators.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/dmetivie/StochasticWeatherGenerators.jl/blob/master/docs/src/models/rain.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Rainfall"><a class="docs-heading-anchor" href="#Rainfall">Rainfall</a><a id="Rainfall-1"></a><a class="docs-heading-anchor-permalink" href="#Rainfall" title="Permalink"></a></h1><ul><li><a href="#Rainfall">Rainfall</a></li><li class="no-marker"><ul><li><a href="#WGEN-—-Multisite-latent-Gaussian-Rain-Occurrence-Model">WGEN — Multisite latent Gaussian Rain Occurrence Model</a></li><li class="no-marker"><ul><li><a href="#Overview">Overview</a></li><li class="no-marker"><ul><li><a href="#Model-Components">Model Components</a></li><li><a href="#Assumptions-and-Limitations">Assumptions &amp; Limitations</a></li><li><a href="#Mathematical-description">Mathematical description</a></li></ul></li><li><a href="#Usage">Usage</a></li></ul></li><li><a href="#SHHMM-—-Seasonal-Hierarchical-Hidden-Markov-Model">SHHMM — Seasonal Hierarchical Hidden Markov Model</a></li><li class="no-marker"><ul><li><a href="#Overview-2">Overview</a></li><li class="no-marker"><ul><li><a href="#Model-Components-2">Model Components</a></li><li><a href="#Assumptions-and-Limitations-2">Assumptions &amp; Limitations</a></li><li><a href="#Mathematical-description-2">Mathematical description</a></li></ul></li><li><a href="#Usage-2">Usage</a></li><li class="no-marker"><ul><li><a href="#Fit">Fit</a></li><li><a href="#Spatial-correlations">Spatial correlations</a></li><li><a href="#Generation">Generation</a></li></ul></li></ul></li><li><a href="#References">References</a></li></ul></li></ul><div class="admonition is-todo" id="Todo-97183aaa297db461"><header class="admonition-header">Todo<a class="admonition-anchor" href="#Todo-97183aaa297db461" title="Permalink"></a></header><div class="admonition-body"><p>Amongst the rich literature of SWG there are many interesting models. For example</p><ul><li>Censored Latent Gaussian models as in (<a href="#cit-2020_vaittinadaayar_SpacetimeSimulationPrecipitation">Vaittinada Ayar <em>et al.</em>, 2020</a>; <a href="#cit-2009_ailliot_SpaceTimeModelling">Ailliot <em>et al.</em>, 2009</a>), etc. In these models, the rainfall occurrence and amounts are generated using the same underlying Gaussian latent variable. It makes possible having very complex spatiotemporal covariance structures.</li><li>The author of (<a href="#cit-2021_najibi_IdentifyingWeatherRegimes">Najibi <em>et al.</em>, 2021</a>) created a <a href="https://github.com/cadillac-desert/wgen">Git repo of their model</a>, which is always cool and interesting. -&gt; investigate</li></ul></div></div><h2 id="WGEN-—-Multisite-latent-Gaussian-Rain-Occurrence-Model"><a class="docs-heading-anchor" href="#WGEN-—-Multisite-latent-Gaussian-Rain-Occurrence-Model">WGEN — Multisite latent Gaussian Rain Occurrence Model</a><a id="WGEN-—-Multisite-latent-Gaussian-Rain-Occurrence-Model-1"></a><a class="docs-heading-anchor-permalink" href="#WGEN-—-Multisite-latent-Gaussian-Rain-Occurrence-Model" title="Permalink"></a></h2><h3 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h3><p>The WGEN model is a weather generator approach using <strong>latent Gaussian variables</strong> to generate multisite rain occurrences with order <span>$p$</span> Markov chain dependence at each site. The model was first proposed in (<a href="#cit-1998_wilks_MultisiteGeneralizationDaily">Wilks, 1998</a>) and extended to order 4 Markov chains in (<a href="#cit-2009_srisrikanthan_NestedMultisiteDaily">Srikanthan and Pegram, 2009</a>).</p><div class="admonition is-warning" id="WGEN-model-9b67c92158e7af33"><header class="admonition-header">WGEN model<a class="admonition-anchor" href="#WGEN-model-9b67c92158e7af33" title="Permalink"></a></header><div class="admonition-body"><p>In the literature, the name WGEN refers to different models e.g. to (<a href="#cit-1981_richardson_StochasticSimulationDaily">Richardson, 1981</a>) !</p></div></div><h4 id="Model-Components"><a class="docs-heading-anchor" href="#Model-Components">Model Components</a><a id="Model-Components-1"></a><a class="docs-heading-anchor-permalink" href="#Model-Components" title="Permalink"></a></h4><ul><li><strong>Single site Temporal Occurrence</strong>: Binary rain/no-rain determined by Markov chain of order <span>$p$</span> at each station.</li><li><strong>Spatial correlation</strong>: Gaussian latent variable with spatial covariance, i.e. Gaussian copula.</li><li><strong>Amount Layer</strong>: Can be added trained on top of the occurrence layer using parametric distributions (e.g., Gamma, mixture of exponential) fitted to positive rain days. See (<a href="#cit-2018_evin_StochasticGenerationMultisite">Evin <em>et al.</em>, 2018</a>) for a more complex rainfall amount model and associated R package <a href="https://github.com/guillaumeevin/GWEX">GWEX</a> (TODO implementation).</li><li><strong>Seasonality</strong>: All parameters are fitted monthly.</li></ul><div class="admonition is-todo" id="Todo-768f28c2eef5e776"><header class="admonition-header">Todo<a class="admonition-anchor" href="#Todo-768f28c2eef5e776" title="Permalink"></a></header><div class="admonition-body"><ul><li>Rewrite the Markov chain efficiently (the generation is slow).</li><li>Current implementation concatenates each month into the likelihood to fit -&gt; add different fit options:<ul><li>Sum the likelihood of each month</li><li>Estimate at each month of each year and take the mean/median of each month</li></ul></li></ul></div></div><h4 id="Assumptions-and-Limitations"><a class="docs-heading-anchor" href="#Assumptions-and-Limitations">Assumptions &amp; Limitations</a><a id="Assumptions-and-Limitations-1"></a><a class="docs-heading-anchor-permalink" href="#Assumptions-and-Limitations" title="Permalink"></a></h4><ul><li>Computational complexity scales as <span>$\mathcal{O}(S^2)$</span> where <span>$S$</span> is the station number, making it less suitable for high-dimensional station networks.</li><li>Lacks explicit hidden states or large-scale regime representation.</li><li>Time and space are fitted separately</li><li>Ideal for small regions.</li></ul><div class="admonition is-todo" id="Todo-a188de4a2ed345dc"><header class="admonition-header">Todo<a class="admonition-anchor" href="#Todo-a188de4a2ed345dc" title="Permalink"></a></header><div class="admonition-body"><p>Model selection</p></div></div><h4 id="Mathematical-description"><a class="docs-heading-anchor" href="#Mathematical-description">Mathematical description</a><a id="Mathematical-description-1"></a><a class="docs-heading-anchor-permalink" href="#Mathematical-description" title="Permalink"></a></h4><p>TODO</p><h3 id="Usage"><a class="docs-heading-anchor" href="#Usage">Usage</a><a id="Usage-1"></a><a class="docs-heading-anchor-permalink" href="#Usage" title="Permalink"></a></h3><p>See the <a href="../../examples/tuto_paper/#TutoWGEN">WGEN model section</a> of the <a href="../../examples/tuto_paper/#TutoSHHMM">tutorial</a> for an example of fit and simulation.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="StochasticWeatherGenerators.wgen" href="#StochasticWeatherGenerators.wgen"><code>StochasticWeatherGenerators.wgen</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">wgen
wgen(p::Integer, D::Integer, ncat::Integer=2)
wgen(p::Integer, D::Integer, idxs::AbstractArray, ncat::Integer=2)</code></pre><p>Structure for a multisite rain occurrence model as described in (Wilks 1998) and generalized to higher order by Srikanthan et al. (2009).  It contains Markov chain transition probabilities of order <code>p</code> at each sites <code>j ∈ 1:D</code>, and a correlation matrix for the unobserved Multivariate Gaussian variable (used to generate correlated rain occurrences). When <code>idxs</code> is provided it is an <code>Vector</code> of size 12 (typically) with index of days corresponding to each months. <code>ncat</code> can be larger than 2 to model generic categorical variables (experimental feature).</p><p><strong>Example</strong></p><pre><code class="language-julia hljs">p = 4
date_range = Date(1956):Day(1):Date(2019,12,31)
D = 5
Y = rand(Bool, length(date_range), D)
idx_months = [findall(x -&gt; month.(x) == m, date_range) for m in 1:12]
# Fit returning a `wgen` struct
wgen4_model = fit_wgen(Y, idx_months, wgen_order)
# Simulate from `wgen` struct
Y_simu = rand(wgen4_model, 1956:2019; Y_ini=rand(Bool, p, D))</code></pre><p><strong>References</strong></p><ul><li>Wilks, D. S. &quot;Multisite generalization of a daily stochastic precipitation generation model&quot;. Journal of Hydrology, (1998). https://doi.org/10.1016/S0022-1694(98)00186-3.</li><li>Srikanthan, Ratnasingham, et Geoffrey G. S. Pegram. &quot;A nested multisite daily rainfall stochastic generation model&quot;. Journal of Hydrology 2009. https://doi.org/10.1016/j.jhydrol.2009.03.025.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dmetivie/StochasticWeatherGenerators.jl/blob/96aa434eda45fffb8d4be7b101290a57c94385af/src/rain/wgen.jl#L6-L32">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="StochasticWeatherGenerators.fit_wgen" href="#StochasticWeatherGenerators.fit_wgen"><code>StochasticWeatherGenerators.fit_wgen</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">fit_wgen(Y::AbstractMatrix, idxs, p::Integer; kwargs...)</code></pre><p>Use <code>fit_markov_chain</code> at each sites and each set of <code>idxs</code> to fit Markov chain of order <code>p</code>. Then it fits the multivariate Gaussian copula for occurrences (each month) with <code>fit_Ω</code>. Return a <code>wgen</code> structure.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dmetivie/StochasticWeatherGenerators.jl/blob/96aa434eda45fffb8d4be7b101290a57c94385af/src/rain/wgen.jl#L59-L64">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="StochasticWeatherGenerators.fit_Ω" href="#StochasticWeatherGenerators.fit_Ω"><code>StochasticWeatherGenerators.fit_Ω</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">fit_Ω(transition_probs, Y; ω0=(-0.999, 0.999))
fit_Ω(transition_probs::AbstractMatrix, Y, idxs; ω0=(-0.999, 0.999))</code></pre><p>Fit the multisite multivariate Gaussian variable.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dmetivie/StochasticWeatherGenerators.jl/blob/96aa434eda45fffb8d4be7b101290a57c94385af/src/rain/wgen.jl#L160-L164">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.rand-Tuple{wgen, AbstractArray{&lt;:Integer}}" href="#Base.rand-Tuple{wgen, AbstractArray{&lt;:Integer}}"><code>Base.rand</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">rand(model::wgen, years::AbstractArray{&lt;:Integer}; Y_ini)</code></pre><p>Takes a <code>wgen</code> struct TODO    </p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dmetivie/StochasticWeatherGenerators.jl/blob/96aa434eda45fffb8d4be7b101290a57c94385af/src/rain/wgen.jl#L153-L157">source</a></section></article><p>For simple Markov chain of order <span>$p$</span></p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="StochasticWeatherGenerators.fit_markov_chain" href="#StochasticWeatherGenerators.fit_markov_chain"><code>StochasticWeatherGenerators.fit_markov_chain</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">fit_markov_chain(Y::AbstractVector{&lt;:Integer}, p::Integer)
fit_markov_chain(Y::AbstractMatrix{&lt;:Integer}, p::Integer)
fit_markov_chain(Y::AbstractMatrix{&lt;:Integer}, idxs::AbstractArray, p::Integer)</code></pre><pre><code class="language-julia hljs">y = rand(Bool, 1000)
markov = fit_markov_chain(y, 2)
markov[[0,1]]</code></pre><p>TODO: add doc</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dmetivie/StochasticWeatherGenerators.jl/blob/96aa434eda45fffb8d4be7b101290a57c94385af/src/rain/wgen.jl#L71-L81">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="StochasticWeatherGenerators.simulate_markov_gaussian" href="#StochasticWeatherGenerators.simulate_markov_gaussian"><code>StochasticWeatherGenerators.simulate_markov_gaussian</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">simulate_markov_gaussian(N::Integer, ΩX::AbstractMatrix, transition_probs; Y_ini)
simulate_markov_gaussian(years::AbstractArray{&lt;:Integer}, ΩX, transition_probs; Y_ini)</code></pre><p>Function to simulate <code>Xt</code> given a correlation matrix <code>ΩX</code> and transition probabilities.</p><ul><li>If <code>N</code> is an integer then it return a sequence of size <code>N</code> with fixed parameters.</li><li>If not then it </li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dmetivie/StochasticWeatherGenerators.jl/blob/96aa434eda45fffb8d4be7b101290a57c94385af/src/rain/wgen.jl#L110-L117">source</a></section></article><h2 id="SHHMM-—-Seasonal-Hierarchical-Hidden-Markov-Model"><a class="docs-heading-anchor" href="#SHHMM-—-Seasonal-Hierarchical-Hidden-Markov-Model">SHHMM — Seasonal Hierarchical Hidden Markov Model</a><a id="SHHMM-—-Seasonal-Hierarchical-Hidden-Markov-Model-1"></a><a class="docs-heading-anchor-permalink" href="#SHHMM-—-Seasonal-Hierarchical-Hidden-Markov-Model" title="Permalink"></a></h2><h3 id="Overview-2"><a class="docs-heading-anchor" href="#Overview-2">Overview</a><a class="docs-heading-anchor-permalink" href="#Overview-2" title="Permalink"></a></h3><p><code>SHHMM</code> is a <strong>multisite stochastic weather generator</strong> (SWG) based on a <strong>seasonal Hidden Markov Model (HMM)</strong>. The model was proposed in (<a href="#cit-2025_gobet_InterpretableSeasonalMultisite">Gobet <em>et al.</em>, 2025</a>) by one author of this package. It is designed to generate <strong>temporally and spatially correlated precipitation sequences</strong> over large regions (e.g., France), while maintaining full interpretability. It has a <strong>Hierarchical Structure</strong> as it combines a discrete HMM for occurrences with a <strong>seasonal rainfall amount model</strong> conditional on the hidden states.</p><h4 id="Model-Components-2"><a class="docs-heading-anchor" href="#Model-Components-2">Model Components</a><a class="docs-heading-anchor-permalink" href="#Model-Components-2" title="Permalink"></a></h4><ul><li><strong>Hidden Weather Regimes</strong>: The model infers interpretable hidden states (weather regimes) from daily <strong>rain occurrence</strong> data, without relying on exogenous variables.</li><li><strong>Rain Occurrence Layer</strong>: Discrete Bernoulli HMM modeling rain/no-rain across stations.</li><li><strong>Local Memory</strong>: Incorporates autoregressive memory for dry/wet persistence (Auto-Regressive HMM). The local memory can be per site. TODO: doc</li><li><strong>Rainfall amount Layer</strong>: Gaussian copula-based model to assign amounts conditioned on the occurrence and hidden states. The parametric form can be an arbitrary continuous distribution from <code>Distributions.jl</code>.</li><li><strong>Seasonality</strong>: All model parameters vary continuously over the year.</li></ul><h4 id="Assumptions-and-Limitations-2"><a class="docs-heading-anchor" href="#Assumptions-and-Limitations-2">Assumptions &amp; Limitations</a><a class="docs-heading-anchor-permalink" href="#Assumptions-and-Limitations-2" title="Permalink"></a></h4><ul><li>Relies on the <strong>conditional independence</strong> assumption — dense station networks may violate this.</li><li>Computational complexity is <span>$\mathcal{O}(S)$</span> and <span>$\mathcal{O}(K^2)$</span> (number of hidden states).</li><li>Tail behavior/extreme events can challenge the stability or identifiability of the hidden states.</li><li>Trade-off between <strong>model interpretability</strong> and spatial resolution.</li><li><strong>Ideal</strong> to studying climate variability over large regions.</li></ul><div class="admonition is-todo" id="Todo-591d995cf679ade5"><header class="admonition-header">Todo<a class="admonition-anchor" href="#Todo-591d995cf679ade5" title="Permalink"></a></header><div class="admonition-body"><p>Add model selection details</p></div></div><h4 id="Mathematical-description-2"><a class="docs-heading-anchor" href="#Mathematical-description-2">Mathematical description</a><a class="docs-heading-anchor-permalink" href="#Mathematical-description-2" title="Permalink"></a></h4><p>TODO</p><img src="https://github.com/dmetivie/StochasticWeatherGenerators.jl/assets/46794064/5fe1d677-877d-4fd5-83ac-29d30f728ca5" width="95%" alt = "Schematic of the Autoregressive Seasonal Hidden Markov Model"/><h3 id="Usage-2"><a class="docs-heading-anchor" href="#Usage-2">Usage</a><a class="docs-heading-anchor-permalink" href="#Usage-2" title="Permalink"></a></h3><p>For a complete example see the <a href="../../examples/tuto_paper/#TutoSHHMM">this section</a> that both serve as a tutorial to fit, simulate and visualize the SHHMM model <strong>and</strong> the reproducible supplementary material of the paper (<a href="#cit-2025_gobet_InterpretableSeasonalMultisite">Gobet <em>et al.</em>, 2025</a>). Some element of the paper are not included in the tutorial to limit runtime of CI (model selection, Weather Regimes illustration, comparison with climate models).</p><h4 id="Fit"><a class="docs-heading-anchor" href="#Fit">Fit</a><a id="Fit-1"></a><a class="docs-heading-anchor-permalink" href="#Fit" title="Permalink"></a></h4><p>Fit functions condition on <strong>given</strong> hidden states. Fix <code>K=1</code> or <code>z=ones(size(Y,A))</code> if you do not have hidden states.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="SmoothPeriodicStatsModels.fit_mle_RO" href="#SmoothPeriodicStatsModels.fit_mle_RO"><code>SmoothPeriodicStatsModels.fit_mle_RO</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">fit_mle_RO(df::DataFrame, K, T, degree, local_order)</code></pre><p>Given a DataFrame <code>df</code> with known hidden states column <code>z ∈ 1:K</code>. The rain occurrences of the new station are fitted conditionally to the hidden state. For <code>local_order&gt;0</code> the model is also autoregressive with its past.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dmetivie/StochasticWeatherGenerators.jl/blob/96aa434eda45fffb8d4be7b101290a57c94385af/ext/SmoothPeriodicStatsModelsExt/fit_mle_rain.jl#L6-L10">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="StochasticWeatherGenerators.fit_mle_RR" href="#StochasticWeatherGenerators.fit_mle_RR"><code>StochasticWeatherGenerators.fit_mle_RR</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">fit_mle_RR(df::DataFrame, local_order,  K = length(unique(df.z)); maxiter=5000, tol=2e-4, robust=true, silence=true, warm_start=true, display=:none, mix₀=mix_ini(length(unique(dayofyear_Leap.(df.DATE)))))</code></pre><p>Fit the strictly positive rainfall amounts <code>RR&gt;0</code> distribution <span>$g_{k,t}(r)$</span> w.r.t. to each hidden states <code>k∈[1,K]</code> (provided in a column of <code>df.z</code>).  The fitted model could in principle be any seasonal model. For now by default it is a double exponential model,</p><p><span>$g_{k,t}(r) = \alpha(t,k)\exp(-r/\theta_1(t,k))/\theta_1(t,k) + (1-\alpha(t,k))\exp(-r/\theta_2(t,k))/\theta_2(t,k).$</span></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dmetivie/StochasticWeatherGenerators.jl/blob/96aa434eda45fffb8d4be7b101290a57c94385af/ext/SmoothPeriodicStatsModelsExt/fit_mle_rain.jl#L31-L37">source</a></section></article><p>TO get an initial condition for <code>fit_mle_RR</code>, one can use (for a given hidden state <code>k</code>):</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="StochasticWeatherGenerators.mix_ini" href="#StochasticWeatherGenerators.mix_ini"><code>StochasticWeatherGenerators.mix_ini</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">mix_ini(T::Integer; θσ10 = [0, 0, 0], θσ20 = [2, 0, 0.0], θα0 = [0.0, 0.0, 0])</code></pre><p>Initializes a seasonal mixture model for rainfall amount with two exponential distributions, one of seasonal parameters <code>θσ10</code> and <code>θσ20</code> with a seasonal portion <code>θα0</code> of class 1.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dmetivie/StochasticWeatherGenerators.jl/blob/96aa434eda45fffb8d4be7b101290a57c94385af/ext/SmoothPeriodicStatsModelsExt/fit_mle_rain.jl#L62-L65">source</a></section></article><p>TODO add <code>SmoothPeriodicStatsModels.fit_mle</code></p><h4 id="Spatial-correlations"><a class="docs-heading-anchor" href="#Spatial-correlations">Spatial correlations</a><a id="Spatial-correlations-1"></a><a class="docs-heading-anchor-permalink" href="#Spatial-correlations" title="Permalink"></a></h4><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="StochasticWeatherGenerators.cor_RR" href="#StochasticWeatherGenerators.cor_RR"><code>StochasticWeatherGenerators.cor_RR</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">cor_RR(dfs::AbstractArray{&lt;:DataFrame}[, K]; cor_method=Σ_Spearman2Pearson, force_PosDef = true)</code></pre><p>Compute the (strictly positive) rain pair correlations <code>cor(Rs₁ &gt; 0, Rs₂ &gt; 0)</code> between each pair of stations <code>s₁, s₂</code> for each hidden state <code>Z = k</code>.</p><p>Input: a array <code>dfs</code> of <code>df::DataFrame</code> of length <code>S</code> (number of station) where each <code>df</code> have :DATE, :RR, :z (same :z for each df).</p><p>Output: <code>K</code> correlation matrix of size <code>S×S</code></p><p>Options:</p><ul><li><code>force_PosDef</code> will enforce Positive Definite matrix with <a href="https://github.com/adknudson/NearestCorrelationMatrix.jl">NearestCorrelationMatrix.jl</a>.</li><li><code>cor_method</code>: typically <code>Σ_Spearman2Pearson</code> or <code>Σ_Kendall2Pearson</code></li><li><code>impute_missing</code>: if <code>nothing</code>, <code>missing</code> will be outputted when two stations do not have at least two rain days in common. Otherwise the value <code>impute_missing</code> will be set.</li></ul><pre><code class="language-julia hljs">ΣRR = cor_RR(data_stations, K)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dmetivie/StochasticWeatherGenerators.jl/blob/96aa434eda45fffb8d4be7b101290a57c94385af/src/rain/correlations.jl#L58-L75">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="StochasticWeatherGenerators.cov_RR" href="#StochasticWeatherGenerators.cov_RR"><code>StochasticWeatherGenerators.cov_RR</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">cov_RR(dfs::AbstractArray{&lt;:DataFrame}[, K]; cor_method=Σ_Spearman2Pearson, force_PosDef = true)</code></pre><p>Compute the (strictly positive) rain pair covariance <code>cov(Rs₁ &gt; 0, Rs₂ &gt; 0)</code> between each pair of stations <code>s₁, s₂</code> for each hidden state <code>Z = k</code>.</p><p>Input: a array <code>dfs</code> of <code>df::DataFrame</code> of length <code>S</code> (number of station) where each <code>df</code> have :DATE, :RR, :z (same :z for each df).</p><p>Output: <code>K</code> covariance matrix of size <code>S×S</code></p><p>Options:</p><ul><li><code>force_PosDef</code> will enforce Positive Definite matrix with <a href="https://github.com/adknudson/NearestCorrelationMatrix.jl">NearestCorrelationMatrix.jl</a>.</li><li><code>cor_method</code>: typically <code>Σ_Spearman2Pearson</code> or <code>Σ_Kendall2Pearson</code></li><li><code>impute_missing</code>: if <code>nothing</code>, <code>missing</code> will be outputted when two stations do not have at least two rain days in common. Otherwise the value <code>impute_missing</code> will be set.</li></ul><pre><code class="language-julia hljs">ΣRR = cov_RR(data_stations, K)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dmetivie/StochasticWeatherGenerators.jl/blob/96aa434eda45fffb8d4be7b101290a57c94385af/src/rain/correlations.jl#L108-L125">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="StochasticWeatherGenerators.Σ_Spearman2Pearson" href="#StochasticWeatherGenerators.Σ_Spearman2Pearson"><code>StochasticWeatherGenerators.Σ_Spearman2Pearson</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Σ_Spearman2Pearson(M::AbstractMatrix)</code></pre><p>Compute the Pearson correlation coefficient i.e. the classic one from the Spearman correlation #TODO Add ref</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dmetivie/StochasticWeatherGenerators.jl/blob/96aa434eda45fffb8d4be7b101290a57c94385af/src/rain/correlations.jl#L9-L13">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="StochasticWeatherGenerators.Σ_Kendall2Pearson" href="#StochasticWeatherGenerators.Σ_Kendall2Pearson"><code>StochasticWeatherGenerators.Σ_Kendall2Pearson</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Σ_Kendall2Pearson(M::AbstractMatrix)</code></pre><p>Compute the Pearson correlation coefficient i.e. the classic one from the Kendall correlation #TODO Add ref</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dmetivie/StochasticWeatherGenerators.jl/blob/96aa434eda45fffb8d4be7b101290a57c94385af/src/rain/correlations.jl#L23-L27">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="StochasticWeatherGenerators.joint_rain" href="#StochasticWeatherGenerators.joint_rain"><code>StochasticWeatherGenerators.joint_rain</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">joint_rain(M::AbstractMatrix, j1::Integer, j2::Integer, r = 0)</code></pre><p>Select all the rows of <code>M</code> with values for (two) columns above some value <code>r</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dmetivie/StochasticWeatherGenerators.jl/blob/96aa434eda45fffb8d4be7b101290a57c94385af/src/rain/correlations.jl#L3-L6">source</a></section></article><h4 id="Generation"><a class="docs-heading-anchor" href="#Generation">Generation</a><a id="Generation-1"></a><a class="docs-heading-anchor-permalink" href="#Generation" title="Permalink"></a></h4><p>Function to generate rainfall amounts</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="StochasticWeatherGenerators.rand_RR" href="#StochasticWeatherGenerators.rand_RR"><code>StochasticWeatherGenerators.rand_RR</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">rand_RR(mixs::AbstractArray{&lt;:MixtureModel}, n2t::AbstractVector, z::AbstractVector, y::AbstractMatrix, Σk::AbstractArray)</code></pre><p>Generate a (nonhomegenous) sequence of length <code>length(n2t)</code> of rainfall amounts conditionally to a given dry/wet matrix <code>y</code> and (hidden) state sequence <code>z</code>. Univariate distribution are given by <code>mixs</code> while correlations are given by covariance matrix Σk.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/dmetivie/StochasticWeatherGenerators.jl/blob/96aa434eda45fffb8d4be7b101290a57c94385af/src/rain/generation.jl#L1-L5">source</a></section></article><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><div class="citation canonical"><ul><li><div id="cit-2009_ailliot_SpaceTimeModelling">Ailliot, P.; Thompson, C. and Thomson, P. (2009). <em>Space Time Modelling of Precipitation by Using a Hidden Markov Model and Censored Gaussian Distributions</em>. Journal of the Royal Statistical Society: Series C (Applied Statistics) <strong>58</strong>, 405–426.</div></li><li><div id="cit-2018_evin_StochasticGenerationMultisite">Evin, G.; Favre, A.-C. and Hingray, B. (2018). <em>Stochastic Generation of Multi-Site Daily Precipitation Focusing on Extreme Events</em>. Hydrology and Earth System Sciences <strong>22</strong>, 655–672.</div></li><li><div id="cit-2025_gobet_InterpretableSeasonalMultisite">Gobet, E.; Métivier, D. and Parey, S. (2025). <a href="https://ascmo.copernicus.org/articles/11/159/2025/"><em>Interpretable Seasonal Multisite Hidden Markov Model for Stochastic Rain Generation in France</em></a>. <a href="https://doi.org/10.5194/ascmo-11-159-2025">Advances in Statistical Climatology, Meteorology and Oceanography <strong>11</strong>, 159–201</a>.</div></li><li><div id="cit-2021_najibi_IdentifyingWeatherRegimes">Najibi, N.; Mukhopadhyay, S. and Steinschneider, S. (2021). <em>Identifying Weather Regimes for Regional-Scale Stochastic Weather Generators</em>. <a href="https://doi.org/10.1002/joc.6969">International Journal of Climatology <strong>41</strong>, 2456–2479</a>.</div></li><li><div id="cit-1981_richardson_StochasticSimulationDaily">Richardson, C. W. (1981). <em>Stochastic Simulation of Daily Precipitation, Temperature, and Solar Radiation</em>. Water Resources Research <strong>17</strong>, 182–190.</div></li><li><div id="cit-2009_srisrikanthan_NestedMultisiteDaily">Srikanthan, R. and Pegram, G. G. (2009). <em>A Nested Multisite Daily Rainfall Stochastic Generation Model</em>. <a href="https://doi.org/10.1016/j.jhydrol.2009.03.025">Journal of Hydrology <strong>371</strong>, 142–153</a>.</div></li><li><div id="cit-2020_vaittinadaayar_SpacetimeSimulationPrecipitation">Vaittinada Ayar, P.; Blanchet, J.; Paquet, E. and Penot, D. (2020). <em>Space-Time Simulation of Precipitation Based on Weather Pattern Sub-Sampling and Meta-Gaussian Model</em>. <a href="https://doi.org/10.1016/j.jhydrol.2019.124451">Journal of Hydrology <strong>581</strong>, 124451</a>.</div></li><li><div id="cit-1998_wilks_MultisiteGeneralizationDaily">Wilks, D. S. (1998). <em>Multisite Generalization of a Daily Stochastic Precipitation Generation Model</em>. <a href="https://doi.org/10.1016/S0022-1694(98)00186-3">Journal of Hydrology <strong>210</strong>, 178–191</a>.</div></li></ul></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../others/">Temperature &amp; Others »</a><div class="flexbox-break"></div><p class="footer-message"><a href="https://github.com/dmetivie/StochasticWeatherGenerators.jl">StochasticWeatherGenerators.jl</a> v1.3.2 docs powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Monday 8 September 2025 15:13">Monday 8 September 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
